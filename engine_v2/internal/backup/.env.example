# Configuración de Variables de Entorno para Sistema Enterprise Backup

# Copiar este archivo como .env.backup y configurar según su entorno

# ==========================================
# DIRECTORIOS DE BACKUP
# ==========================================
BACKUP_DIR=./backups
BACKUP_TEMP_DIR=./backups/temp  
BACKUP_ARCHIVE_DIR=./backups/archive

# ==========================================
# CONFIGURACIÓN POSTGRESQL
# ==========================================
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your_postgresql_password_here
DB_NAME=tucentropdf

# ==========================================
# CONFIGURACIÓN REDIS
# ==========================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here

# ==========================================
# CIFRADO (REQUERIDO - CRÍTICO)
# ==========================================
# Generar con: openssl rand -base64 48
# DEBE ser de al menos 32 caracteres
BACKUP_ENCRYPTION_KEY=your-super-secure-encryption-key-minimum-32-characters

# ==========================================
# SINCRONIZACIÓN REMOTA (RCLONE)
# ==========================================
BACKUP_REMOTE_ENABLED=true
RCLONE_REMOTE=drive:/tucentropdf_backups/
RCLONE_CONFIG=/home/user/.config/rclone/rclone.conf

# ==========================================
# POLÍTICAS DE RETENCIÓN (DÍAS)
# ==========================================
BACKUP_RETENTION_FULL_DAYS=30
BACKUP_RETENTION_INCREMENTAL_DAYS=7
BACKUP_RETENTION_REDIS_DAYS=7
BACKUP_RETENTION_CONFIG_DAYS=90
BACKUP_RETENTION_ANALYTICS_DAYS=365

# ==========================================
# CONFIGURACIÓN DE ALERTAS
# ==========================================
BACKUP_MIN_DISK_SPACE_GB=10

# ==========================================
# CONFIGURACIÓN OPCIONAL AVANZADA
# ==========================================

# Configuración de logging
LOG_LEVEL=info

# Timeouts para operaciones (segundos)
BACKUP_TIMEOUT_POSTGRESQL=3600  # 1 hora
BACKUP_TIMEOUT_REDIS=300        # 5 minutos
BACKUP_TIMEOUT_RCLONE=1800      # 30 minutos

# Configuración de reintentos
BACKUP_MAX_RETRIES=3
BACKUP_RETRY_DELAY_SECONDS=30

# Configuración de compresión
BACKUP_COMPRESSION_LEVEL=6      # 1-9 (1=rápido, 9=máximo)

# ==========================================
# EJEMPLOS DE CONFIGURACIÓN RCLONE
# ==========================================

# Para Google Drive:
# rclone config -> n -> google drive -> client_id (opcional) -> client_secret (opcional) -> scope: 1 -> root_folder_id (opcional) -> service_account_file (opcional) -> y -> y

# Para AWS S3:
# rclone config -> n -> s3 -> AWS -> access_key_id -> secret_access_key -> region -> endpoint (opcional) -> location_constraint (opcional) -> acl (opcional) -> y

# Para Azure Blob Storage:
# rclone config -> n -> azureblob -> account -> key -> y

# Para Dropbox:
# rclone config -> n -> dropbox -> client_id (opcional) -> client_secret (opcional) -> y -> y

# ==========================================
# COMANDOS DE CONFIGURACIÓN INICIAL
# ==========================================

# 1. Crear directorios:
# mkdir -p ./backups/{postgresql,redis,config,analytics,temp,archive}

# 2. Generar clave de cifrado:
# echo "BACKUP_ENCRYPTION_KEY=$(openssl rand -base64 48)" >> .env

# 3. Configurar rclone:
# rclone config

# 4. Probar configuración:
# rclone about your-remote:

# 5. Verificar permisos:
# chmod 600 .env
# chmod 750 ./backups

# ==========================================
# VALIDACIÓN DE CONFIGURACIÓN
# ==========================================

# Verificar variables críticas:
# echo $BACKUP_ENCRYPTION_KEY | wc -c  # Debe ser > 32
# echo $DB_PASSWORD                     # No debe estar vacío
# rclone listremotes                    # Debe mostrar su remoto configurado

# ==========================================
# CONFIGURACIÓN DE PRODUCCIÓN
# ==========================================

# Para producción, se recomienda:
# - Usar secretos gestionados (Vault, K8s secrets, etc.)
# - Configurar monitoreo de logs
# - Implementar alertas por email/Slack
# - Programar backups en horarios de bajo tráfico
# - Usar almacenamiento remoto en diferentes regiones geográficas
# - Configurar políticas de retención según compliance
# - Implementar testing regular de restauración

# Ejemplo de configuración Docker Compose:
# services:
#   tucentropdf:
#     environment:
#       - BACKUP_DIR=/app/backups
#       - BACKUP_ENCRYPTION_KEY_FILE=/run/secrets/backup_key
#       - DB_PASSWORD_FILE=/run/secrets/db_password
#     volumes:
#       - backup_data:/app/backups
#       - rclone_config:/root/.config/rclone
#     secrets:
#       - backup_key
#       - db_password